# Руководство по виртуальным инвентарям MegaCreative

## Концепция

Виртуальные инвентари - это инновационная система конфигурации блоков кода, которая позволяет игрокам настраивать параметры блоков через интуитивный GUI инвентаря вместо текстовых полей.

## Как это работает

### 1. Размещение блока
1. Игрок размещает блок кода (например, OAK_PLANKS для условия)
2. Выбирает действие (например, `isBlockType`)
3. Кликает ПКМ по блоку для настройки

### 2. Настройка через GUI
1. Открывается виртуальный инвентарь (9 слотов)
2. Игрок помещает предметы в слоты
3. Предметы сохраняются как параметры блока
4. При закрытии инвентаря конфигурация автоматически сохраняется

### 3. Использование в скриптах
1. При выполнении скрипта блоки читают свои сохраненные предметы
2. Предметы используются как параметры для действий/условий
3. Система автоматически сравнивает, проверяет или использует эти предметы

## Примеры использования

### Пример 1: Проверка типа блока
```
onBlockBreak -> if (block == [алмазная руда]) -> sendMessage("Найдена алмазная руда!")
```

**Настройка:**
1. Поставьте блок события (DIAMOND_BLOCK) с действием `onBlockBreak`
2. Поставьте блок условия (OAK_PLANKS) с действием `isBlockType`
3. Кликните ПКМ по блоку условия
4. Поместите алмазную руду в первый слот
5. Поставьте блок действия (COBBLESTONE) с действием `sendMessage`
6. Соедините блоки связующим жезлом

**Результат:** При ломании алмазной руды игрок получит сообщение.

### Пример 2: Проверка предмета в руке
```
onInteract -> if (item == [меч]) -> teleport("спавн")
```

**Настройка:**
1. Поставьте блок события с действием `onInteract`
2. Поставьте блок условия с действием `hasItem`
3. Кликните ПКМ по блоку условия
4. Поместите меч в первый слот
5. Поставьте блок действия с действием `teleport`
6. Соедините блоки

**Результат:** При взаимодействии с мечом в руке игрок телепортируется на спавн.

## Доступные условия с виртуальными инвентарями

### isBlockType
- **Описание:** Проверяет тип сломанного блока
- **Использование:** Поместите образец блока в слот 0
- **События:** `onBlockBreak`

### hasItem
- **Описание:** Проверяет наличие предмета у игрока
- **Использование:** Поместите образец предмета в слот 0
- **События:** `onJoin`, `onInteract`, `onCommand`

### isNearBlock
- **Описание:** Проверяет наличие блока рядом с игроком
- **Использование:** Поместите образец блока в слот 0
- **События:** `onPlayerMove`, `onInteract`

## Технические детали

### Структура данных
```java
// В CodeBlock
private transient Map<Integer, ItemStack> configItems = new HashMap<>();
```

### Сохранение
- Предметы сохраняются в памяти во время работы сервера
- При перезагрузке предметы восстанавливаются из сохраненных миров
- Используется Gson для сериализации

### Производительность
- Виртуальные инвентари не создают реальных сундуков в мире
- Предметы хранятся как ссылки на объекты ItemStack
- Минимальное влияние на производительность

## Расширение системы

### Добавление новых условий
1. Создайте новый класс, реализующий `BlockCondition`
2. Используйте `context.getCurrentBlock().getConfigItem(slot)` для получения предметов
3. Зарегистрируйте условие в `ScriptExecutor`
4. Добавьте действие в `coding_blocks.yml`

### Добавление новых действий
1. Создайте новый класс, реализующий `BlockAction`
2. Используйте `context.getCurrentBlock().getConfigItems()` для получения всех предметов
3. Зарегистрируйте действие в `ScriptExecutor`
4. Добавьте действие в `coding_blocks.yml`

## Преимущества

### Для игроков
- **Интуитивность:** Визуальная настройка вместо текста
- **Безопасность:** Невозможно ввести неправильный тип блока
- **Скорость:** Быстрая настройка через drag & drop

### Для разработчиков
- **Гибкость:** Легко добавлять новые типы проверок
- **Расширяемость:** Система легко масштабируется
- **Надежность:** Меньше ошибок ввода

## Ограничения

- Максимум 9 слотов в виртуальном инвентаре
- Предметы должны быть валидными ItemStack
- Некоторые сложные параметры могут потребовать дополнительных слотов

## Будущие улучшения

1. **Больше слотов:** Расширение до 27 слотов (3 ряда)
2. **Группировка:** Возможность группировать предметы
3. **Фильтры:** Автоматическая фильтрация по типам предметов
4. **Шаблоны:** Предустановленные конфигурации
5. **Валидация:** Проверка совместимости предметов с действиями 