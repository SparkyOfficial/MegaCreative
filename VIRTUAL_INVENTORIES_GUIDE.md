# Руководство по виртуальным инвентарям MegaCreative

## Концепция

Виртуальные инвентари - это инновационная система конфигурации блоков кода, которая позволяет игрокам настраивать параметры блоков через интуитивный GUI инвентаря вместо текстовых полей.

## Как это работает

### 1. Размещение блока
1. Игрок размещает блок кода (например, OAK_PLANKS для условия)
2. Выбирает действие (например, `isBlockType`)
3. Кликает ПКМ по блоку для настройки

### 2. Настройка через GUI
1. Открывается виртуальный инвентарь (27 слотов - 3 ряда)
2. Игрок помещает предметы в слоты
3. Предметы сохраняются как параметры блока
4. При закрытии инвентаря конфигурация автоматически сохраняется

### 3. Использование в скриптах
1. При выполнении скрипта блоки читают свои сохраненные предметы
2. Предметы используются как параметры для действий/условий
3. Система автоматически сравнивает, проверяет или использует эти предметы

## Примеры использования

### Пример 1: Проверка типа блока
```
onBlockBreak -> if (block == [алмазная руда]) -> sendMessage("Найдена алмазная руда!")
```

**Настройка:**
1. Поставьте блок события (DIAMOND_BLOCK) с действием `onBlockBreak`
2. Поставьте блок условия (OAK_PLANKS) с действием `isBlockType`
3. Кликните ПКМ по блоку условия
4. Поместите алмазную руду в первый слот
5. Поставьте блок действия (COBBLESTONE) с действием `sendMessage`
6. Соедините блоки связующим жезлом

**Результат:** При ломании алмазной руды игрок получит сообщение.

### Пример 2: Проверка предмета в руке
```
onInteract -> if (holding == [меч]) -> teleport("спавн")
```

**Настройка:**
1. Поставьте блок события с действием `onInteract`
2. Поставьте блок условия с действием `isPlayerHolding`
3. Кликните ПКМ по блоку условия
4. Поместите меч в первый слот
5. Поставьте блок действия с действием `teleport`
6. Соедините блоки

**Результат:** При взаимодействии с мечом в руке игрок телепортируется на спавн.

### Пример 3: Выдача предметов
```
onJoin -> giveItems([алмазный меч, алмазная броня]) -> sendMessage("Добро пожаловать!")
```

**Настройка:**
1. Поставьте блок события с действием `onJoin`
2. Поставьте блок действия с действием `giveItems`
3. Кликните ПКМ по блоку действия
4. Поместите алмазный меч и алмазную броню в слоты
5. Соедините блоки

**Результат:** При входе игрок получит указанные предметы.

### Пример 4: Спавн существ
```
onInteract -> spawnEntity([зомби]) -> sendMessage("Зомби появился!")
```

**Настройка:**
1. Поставьте блок события с действием `onInteract`
2. Поставьте блок действия с действием `spawnEntity`
3. Кликните ПКМ по блоку действия
4. Поместите зомби голову в первый слот
5. Поместите бумагу с текстом "количество:3" во второй слот
6. Поместите бумагу с текстом "радиус:5" в третий слот
7. Соедините блоки

**Результат:** При взаимодействии появится 3 зомби в радиусе 5 блоков.

## Доступные условия с виртуальными инвентарями

### isBlockType
- **Описание:** Проверяет тип сломанного блока
- **Использование:** Поместите образец блока в слот 0
- **События:** `onBlockBreak`

### isPlayerHolding
- **Описание:** Проверяет предмет в руке игрока
- **Использование:** Поместите образец предмета в слот 0
- **События:** `onInteract`, `onCommand`

### isNearEntity
- **Описание:** Проверяет наличие существ рядом с игроком
- **Использование:** Поместите предмет существа в слот 0, бумагу с радиусом в слот 1
- **События:** `onPlayerMove`, `onInteract`

### hasArmor
- **Описание:** Проверяет броню игрока
- **Использование:** Поместите образец брони в слот 0
- **События:** `onJoin`, `onInteract`

### hasItem
- **Описание:** Проверяет наличие предмета у игрока
- **Использование:** Поместите образец предмета в слот 0
- **События:** `onJoin`, `onInteract`, `onCommand`

### isNearBlock
- **Описание:** Проверяет наличие блока рядом с игроком
- **Использование:** Поместите образец блока в слот 0
- **События:** `onPlayerMove`, `onInteract`

## Доступные действия с виртуальными инвентарями

### giveItems
- **Описание:** Выдает предметы игроку
- **Использование:** Поместите предметы для выдачи в слоты 0-8
- **Параметры:** `amount` - количество каждого предмета

### spawnEntity
- **Описание:** Спавнит существ
- **Использование:** Поместите предмет существа в слот 0
- **Параметры:** 
  - Слот 1: бумага с текстом "количество:X"
  - Слот 2: бумага с текстом "радиус:X"

## Система группировки предметов

### Создание групп
```java
// В коде блока
codeBlock.createItemGroup("weapons", Arrays.asList(0, 1, 2));
codeBlock.createItemGroup("armor", Arrays.asList(3, 4, 5));
```

### Использование групп
```java
// Получение предметов из группы
List<ItemStack> weapons = codeBlock.getItemsFromGroup("weapons");
```

## Расширенные типы данных

### Списки
```java
// Создание списка
context.setList("players", Arrays.asList("player1", "player2"));

// Добавление элемента
context.addToList("items", "new_item");

// Получение списка
List<Object> players = context.getList("players");
```

### Булевы переменные
```java
// Установка булевой переменной
context.setBoolean("isAdmin", true);

// Получение булевой переменной
Boolean isAdmin = context.getBoolean("isAdmin");
```

### Числовые переменные
```java
// Установка числа
context.setNumber("score", 100);
context.setNumber("health", 20.5);

// Получение числа
int score = context.getInt("score");
double health = context.getDouble("health");
```

## Технические детали

### Структура данных
```java
// В CodeBlock
private transient Map<Integer, ItemStack> configItems = new HashMap<>();
private transient Map<String, List<Integer>> itemGroups = new HashMap<>();
```

### Сохранение
- Предметы сохраняются в памяти во время работы сервера
- При перезагрузке предметы восстанавливаются из сохраненных миров
- Используется Gson для сериализации

### Производительность
- Виртуальные инвентари не создают реальных сундуков в мире
- Предметы хранятся как ссылки на объекты ItemStack
- Минимальное влияние на производительность

## Расширение системы

### Добавление новых условий
1. Создайте новый класс, реализующий `BlockCondition`
2. Используйте `context.getCurrentBlock().getConfigItem(slot)` для получения предметов
3. Зарегистрируйте условие в `ScriptExecutor`
4. Добавьте действие в `coding_blocks.yml`

### Добавление новых действий
1. Создайте новый класс, реализующий `BlockAction`
2. Используйте `context.getCurrentBlock().getConfigItems()` для получения всех предметов
3. Зарегистрируйте действие в `ScriptExecutor`
4. Добавьте действие в `coding_blocks.yml`

## Преимущества

### Для игроков
- **Интуитивность:** Визуальная настройка вместо текста
- **Безопасность:** Невозможно ввести неправильный тип блока
- **Скорость:** Быстрая настройка через drag & drop
- **Гибкость:** 27 слотов для сложных конфигураций

### Для разработчиков
- **Гибкость:** Легко добавлять новые типы проверок
- **Расширяемость:** Система легко масштабируется
- **Надежность:** Меньше ошибок ввода
- **Типизация:** Поддержка различных типов данных

## Ограничения

- Максимум 27 слотов в виртуальном инвентаре
- Предметы должны быть валидными ItemStack
- Некоторые сложные параметры могут потребовать дополнительных слотов

## Будущие улучшения

1. **Больше слотов:** Расширение до 54 слотов (6 рядов)
2. **Группировка:** Возможность группировать предметы через GUI
3. **Фильтры:** Автоматическая фильтрация по типам предметов
4. **Шаблоны:** Предустановленные конфигурации
5. **Валидация:** Проверка совместимости предметов с действиями
6. **Поиск:** Поиск предметов в виртуальном инвентаре
7. **Сортировка:** Автоматическая сортировка предметов
8. **Экспорт/Импорт:** Сохранение и загрузка конфигураций 